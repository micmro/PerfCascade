<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>PerfCascade - HAR and more Waterfall viewer</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- import PerfCascade styles /-->
  <link rel="stylesheet" href="/build/stage/perf-cascade-demo.css">
</head>

<body>

  <div id="legendHolder"></div>

  <input type="file" id="fileinput" />
  <select id="page-selector" class="page-selector"></select>
  <div id="output" class="output"></div>

  <input type="file" id="fileinput2" />
  <select id="page-selector2" class="page-selector"></select>
  <div id="output2" class="output"></div>

  <!-- import PerfCascade JS /-->
  <script src="/build/stage/perf-cascade.js"></script>
  <script src="/build/stage/perf-cascade-file-reader.js"></script>
  <script src="https://raw.githubusercontent.com/github/fetch/master/fetch.js"></script>

  <script>
       /**
        * functionality for example page
        * `perfCascade` is a global object if not running in AMD or CommonJS context
       */
      (function(perfCascade){

        /** holder DOM element to render PerfCascade into */
        var outputHolderEl = document.getElementById("output")
        var pageSelectorEl = document.getElementById("page-selector")
        var outputHolder2El = document.getElementById("output2")
        var pageSelector2El = document.getElementById("page-selector2")
        var legendHolderEl = document.getElementById("legendHolder")

        function setup(options, fileinputId, outputHolder) {
          /**
           * This is where the magic happens
           */
          function renderPerfCascadeChart(logData) {
              /** remove all children of `outputHolderEl`,
               * so you can upload new HAR files and get a new SVG  */
              while (outputHolder.childNodes.length > 0) {
                  outputHolder.removeChild(outputHolder.childNodes[0])
              }

              /** pass HAR and options to `newPerfCascadeHar` to generate the SVG element*/
              var perfCascadeSvg =  perfCascade.fromHar(logData, options)

              /** append SVG to page - that's it */
              outputHolder.appendChild(perfCascadeSvg)
          }


          /** handle client side file upload via file-reader */
          function onFileSubmit(evt) {
              var files = evt.target.files
              if (!files) {
                  alert("Failed to load HAR file")
                  return
              }

              // Just needed for gzipped *.zhar files, you can use the standard FileReader api for normal .har files
              perfCascadeFileReader.readFile(files[0], evt.target.value, function(error, data){
                  if(error){
                      console.error(error)
                  }else{
                      renderPerfCascadeChart(data)
                  }
              })
          }

          if (window["fetch"]) {/** load an initial HAR when opening the page */
          //Source: http://www.webpagetest.org/result/151226_X7_b43d35e592fab70e0ba012fe11a41020/
          // window["fetch"]("test-data/www.bbc.co.uk.160529_8V_7R3.har")
          // window["fetch"]("test-data/www.bbc.com.har")
          window["fetch"]("test-data/github.com.MODIFIED.151226_X7_b43d35e592fab70e0ba012fe11a41020.har")
            .then(f => f.json().then(j => renderPerfCascadeChart(j.log)))}

          /** hook up file input events */
          document.getElementById(fileinputId).addEventListener("change", onFileSubmit, false)
      }

      setup({pageSelector: pageSelectorEl, legendHolder: legendHolderEl}, "fileinput", outputHolderEl);
      setup({pageSelector: pageSelector2El}, "fileinput2", outputHolder2El);
      })(window.perfCascade)
    </script>
</body>

</html>
